<%- include("partials/header") %>

  <div class="sort-bar">
    <span>Sort by:</span>
    <a href="/?sort=rating">‚≠ê Rating</a>
    <a href="/?sort=recent">üïí Recent</a>
    <a href="/?sort=title">üî§ Title</a>
  </div>

  <div class="book-grid">
    <% books.forEach(book=> { %>
      <div class="book-card">
        <img src="<%= book.coverUrl %>" alt="Book cover" />
        <h3>
          <%= book.title %>
        </h3>
        <p class="author">
          <%= book.author %>
        </p>
        <p class="notes">
          <%= book.notes %>
        </p>
        <div class="meta">
          <span>‚≠ê <%= book.rating %></span>
          <span>üìÖ <%= book.date_read %></span>
        </div>
        <div class="actions">
          <a href="/edit/<%= book.id %>">Edit</a>
          <button type="button" class="delete-btn" data-id="<%= book.id %>"
            data-title="<%= book.title %>">Delete</button>
        </div>
      </div>
      <% }) %>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <h3>üóëÔ∏è Delete Book</h3>
      <p>Are you sure you want to delete "<span id="bookTitleToDelete"></span>"?</p>
      <form id="deleteForm" method="POST" action="">
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
          <button type="submit" class="btn-delete">Yes, Delete</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Add click handlers to all delete buttons
    document.querySelectorAll('.delete-btn').forEach(function (btn) {
      btn.addEventListener('click', function () {
        var bookId = this.getAttribute('data-id');
        var bookTitle = this.getAttribute('data-title');
        document.getElementById('bookTitleToDelete').textContent = bookTitle;
        document.getElementById('deleteForm').action = '/delete/' + bookId;
        document.getElementById('deleteModal').classList.add('active');
      });
    });

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
    }

    // Close modal when clicking outside
    document.getElementById('deleteModal').addEventListener('click', function (e) {
      if (e.target === this) {
        closeDeleteModal();
      }
    });
  </script>

  <%- include("partials/footer") %>